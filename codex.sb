;; B″ 修正版：系统只读 + 项目父目录只读（补 /etc & /private/etc）
(version 1)
(deny default)

;; 进程启动/系统信息
(allow process-exec)
(allow sysctl*)

;; —— 系统目录：只读 + 可执行映射（dyld 会用到）——
(allow file-read*
  (subpath "/bin")
  (subpath "/sbin")
  (subpath "/usr")
  (subpath "/System")
  (subpath "/Library")
  (subpath "/private/var")
  (subpath "/System/Volumes")
  (subpath "/etc")           ;; 关键补充
  (subpath "/private/etc")   ;; 关键补充（/etc 通常指向这里）
)
(allow file-map-executable
  (subpath "/bin")
  (subpath "/sbin")
  (subpath "/usr")
  (subpath "/System")
  (subpath "/Library")
  (subpath "/private/var")
  (subpath "/System/Volumes")
)

;; 根目录读取（解析绝对路径需要遍历 / 的目录项）
(allow file-read-data      (literal "/"))
(allow file-read-metadata  (literal "/"))
(allow file-read-metadata (subpath "/Users"))
(allow file-read-metadata (subpath "/Users/jqwang"))
(allow file-read-metadata (subpath "/Users/jqwang/104-CommitLens"))


;; 设备文件
(allow file-read-data  (literal "/dev/urandom"))
(allow file-read-data  (literal "/dev/null"))
(allow file-write-data (literal "/dev/null"))
(allow file-ioctl      (literal "/dev/null"))  ;; 有些工具会对 /dev/null 做 ioctl



;; 你的项目父目录只读（B 步）
;; (allow file-read* (subpath "/Users/jqwang/104-CommitLens"))
;; 项目可读写输出目录（仅这两个目录允许写入）
(allow file-read*
  (subpath "/Users/jqwang/104-CommitLens/.sboxes/001-75ebbb7/figs")
  (subpath "/Users/jqwang/104-CommitLens/.sboxes/001-75ebbb7/reports")
)
